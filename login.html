<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zuber Login</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  color:white;
  font-family:sans-serif;
}

.box{
  width:400px;
  background:#222;
  padding:30px;
  border-radius:15px;
}
</style>
</head>
<body>

<div class="box">

<h4 class="mb-3">Login</h4>

<!-- PHONE INPUT -->
<input type="text" id="phone" class="form-control mb-3" placeholder="+91XXXXXXXXXX">

<div id="recaptcha-container" class="mb-3"></div>

<button id="sendBtn" class="btn btn-warning w-100 mb-3">
Send OTP
</button>

<input type="text" id="otp" class="form-control mb-3" placeholder="Enter OTP">

<button id="verifyBtn" class="btn btn-success w-100 mb-3">
Verify OTP
</button>

<hr class="bg-light">

<button id="googleBtn" class="btn btn-light w-100">
Continue with Google
</button>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
getAuth,
RecaptchaVerifier,
signInWithPhoneNumber,
GoogleAuthProvider,
signInWithPopup
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAJV5fTOsgDy2J1nQzMvv_nFmJ65wLWl-8",
  authDomain: "zuber-ride-system.firebaseapp.com",
  projectId: "zuber-ride-system",
  appId: "1:645714565277:web:3f7f769fd541af46391c74"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

console.log("Firebase Loaded");

/* Recaptcha Setup */
const recaptcha = new RecaptchaVerifier(
  auth,
  'recaptcha-container',
  { size: 'normal' }
);

/* SEND OTP */
document.getElementById("sendBtn").addEventListener("click", async () => {

  const phone = document.getElementById("phone").value;

  if(phone === ""){
    alert("Enter phone number");
    return;
  }

  try{
    const confirmation = await signInWithPhoneNumber(auth, phone, recaptcha);
    window.confirmationResult = confirmation;
    alert("OTP Sent Successfully");
  }
  catch(error){
    console.error(error);
    alert(error.message);
  }

});

/* VERIFY OTP */
document.getElementById("verifyBtn").addEventListener("click", async () => {

  const code = document.getElementById("otp").value;

  if(code === ""){
    alert("Enter OTP");
    return;
  }

  try{
    await window.confirmationResult.confirm(code);
    alert("Phone Login Success");
  }
  catch(error){
    alert("Invalid OTP");
  }

});

/* GOOGLE LOGIN */
document.getElementById("googleBtn").addEventListener("click", async () => {

  try{
    const provider = new GoogleAuthProvider();
    await signInWithPopup(auth, provider);
    alert("Google Login Success");
  }
  catch(error){
    console.error(error);
    alert(error.message);
  }

});

</script>

</body>
</html>
