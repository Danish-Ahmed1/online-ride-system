<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zuber Signup</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body{
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:sans-serif;
}
.box{
  width:400px;
  background:#222;
  padding:30px;
  border-radius:15px;
  color:white;
}
input, select{
  height:45px;
}
.btn-main{
  background:#ffc107;
  border:none;
}
</style>
</head>
<body>

<div class="box">
<h4 class="mb-3">Signup</h4>

<input type="text" id="phone" class="form-control mb-3" placeholder="+91XXXXXXXXXX">

<select id="role" class="form-select mb-3">
<option value="rider">Rider</option>
<option value="driver">Driver</option>
<option value="admin">Admin</option>
</select>

<div id="recaptcha-container"></div>

<button onclick="sendOTP()" class="btn btn-main w-100 mb-3">
Send OTP
</button>

<input type="text" id="otp" class="form-control mb-3" placeholder="Enter OTP">

<button onclick="verifyOTP()" class="btn btn-success w-100">
Verify & Signup
</button>

<p class="text-center mt-3">
Already registered?
<a href="login.html" style="color:#ffc107;">Login</a>
</p>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import { getFirestore, doc, setDoc } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAJV5fTOsgDy2J1nQzMvv_nFmJ65wLWl-8",
  authDomain: "zuber-ride-system.firebaseapp.com",
  projectId: "zuber-ride-system",
  appId: "1:645714565277:web:3f7f769fd541af46391c74"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.recaptchaVerifier = new RecaptchaVerifier(
'recaptcha-container',
{ size: 'normal' },
auth
);

window.sendOTP = async function(){
  const phone = document.getElementById("phone").value;
  if(phone === "") return alert("Enter phone number");

  const confirmation = await signInWithPhoneNumber(auth, phone, window.recaptchaVerifier);
  window.confirmationResult = confirmation;
  alert("OTP Sent");
}

window.verifyOTP = async function(){

  const code = document.getElementById("otp").value;
  const role = document.getElementById("role").value;

  const result = await confirmationResult.confirm(code);
  const user = result.user;

  await setDoc(doc(db,"users",user.uid),{
    phone:user.phoneNumber,
    role:role,
    createdAt:new Date()
  });

  if(role==="admin") window.location="admin.html";
  else if(role==="driver") window.location="driver.html";
  else window.location="dashboard.html";
}

</script>
</body>
</html>
